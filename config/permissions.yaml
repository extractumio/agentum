# Permission profile for Agentum agent.
# Loaded once at startup and used throughout execution.
# Session-specific permissions are generated dynamically using {workspace} placeholder.
# Agent is sandboxed to its workspace with limited bash access.

name: user
description: User profile for task execution. Session-specific permissions are generated dynamically.
defaultMode: default

tools:
  enabled:
    - Read
    - Edit
    - MultiEdit
    - Task
    - Skill
    - TodoRead
    - TodoWrite
    - Glob
    - Grep
    - LS
    - WebFetch
    - WebSearch
    - NotebookEdit
    - Write
    - Bash
  disabled:
  permission_checked:
    - Read
    - Write
    - Edit
    - MultiEdit
    - Bash

session_workspace:
  description: Patterns for session-specific workspace permissions.
  allow:
    # Session workspace access (output.yaml, results, etc.)
    - Read({workspace}/**)
    - Write({workspace}/**)
    - Edit({workspace}/**)
    - MultiEdit({workspace}/**)
    # Relative paths from cwd (which is set to workspace)
    - Read(./**)
    - Write(./**)
    - Edit(./**)
    - MultiEdit(./**)
    
    # Skills directory read access (mapped to /skills)
    # The path normalization hook converts absolute /skills paths to relative ./skills
    # But we keep this for robust matching if normalization is bypassed/fails
    - Read(./skills/**)
    - Read(/skills/**)
    
    # Allow all Bash commands (relies on sandbox isolation)
    - Bash(*)
    - Glob(*)
    - Grep(*)
    - LS(*)
    
    - Task
    - Skill
    - TodoRead
    - TodoWrite
    
  deny:
    # Block access to system paths if not covered by sandbox (though sandbox handles this)
    # We explicitly deny writing to skills (both absolute and relative paths)
    - Write(/skills/**)
    - Edit(/skills/**)
    - MultiEdit(/skills/**)
    - Write(./skills/**)
    - Edit(./skills/**)
    - MultiEdit(./skills/**)
    # Disallow absolute paths and parent traversal outside workspace
    - Read(/**)
    - Write(/**)
    - Edit(/**)
    - MultiEdit(/**)
    - Glob(/**)
    - Grep(/**)
    - LS(/**)
    - Read(../**)
    - Write(../**)
    - Edit(../**)
    - MultiEdit(../**)
    - Glob(../**)
    - Grep(../**)
    - LS(../**)
    # Block high-risk or introspection Bash commands via SDK permissions
    - Bash(kill *)
    - Bash(killall *)
    - Bash(pkill *)
    - Bash(shutdown *)
    - Bash(reboot *)
    - Bash(poweroff *)
    - Bash(halt *)
    - Bash(systemctl *)
    - Bash(service *)
    - Bash(mount *)
    - Bash(umount *)
    - Bash(chroot *)
    - Bash(iptables *)
    - Bash(nft *)
    - Bash(netstat *)
    - Bash(ss *)
    - Bash(lsof *)
    - Bash(ps *)
    - Bash(top *)
    - Bash(htop *)

  allowed_dirs:
    - "{workspace}"
    # We include /skills here so the permissions manager knows this is a valid target 
    # for reading, even if the agent accesses it via ./skills (which resolves to /skills)
    - "/skills"

# Sandbox configuration (bubblewrap). Toggle for non-docker runs as needed.
sandbox:
  enabled: true
  file_sandboxing: true
  network_sandboxing: true
  bwrap_path: "bwrap"
  use_tmpfs_root: true
  static_mounts:
    skills:
      source: "{agent_dir}/skills"
      target: "/skills"
      mode: ro
    system_usr:
      source: "/usr"
      target: "/usr"
      mode: ro
    system_lib:
      source: "/lib"
      target: "/lib"
      mode: ro
    system_bin:
      source: "/bin"
      target: "/bin"
      mode: ro
  session_mounts:
    workspace:
      source: "{workspace_dir}"
      target: "/workspace"
      mode: rw
  dynamic_mounts: []
  network:
    enabled: true
    allowed_domains: []
    allow_localhost: true
  environment:
    home: "/workspace"
    path: "/usr/bin:/bin"
    clear_env: true
  writable_paths:
    - "/workspace"
  readonly_paths:
    - "/skills"
    - "/usr"
    - "/lib"
    - "/bin"

# File checkpointing configuration
checkpointing:
  # Tools that trigger automatic checkpoint creation after execution
  auto_checkpoint_tools:
    - Write
    - Edit
    - MultiEdit
